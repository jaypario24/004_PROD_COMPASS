<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <apiVersion>52.0</apiVersion>
    <assignments>
        <name>Medication_Assignment</name>
        <label>Medication Assignment</label>
        <locationX>288</locationX>
        <locationY>1106</locationY>
        <assignmentItems>
            <assignToReference>AllMedicationsandDosages</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>LoopRecord</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Medication_Loop</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Even_Day</name>
        <label>Even Day</label>
        <locationX>51</locationX>
        <locationY>1258</locationY>
        <defaultConnector>
            <targetReference>Medication_Loop</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Even_Day_Decision</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>ODDEVENFormula</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Even</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Medication_Assignment</targetReference>
            </connector>
            <label>Even Day</label>
        </rules>
    </decisions>
    <decisions>
        <name>Regime_Not_Daily</name>
        <label>Regime Not Daily</label>
        <locationX>276</locationX>
        <locationY>894</locationY>
        <defaultConnector>
            <targetReference>Medication_Assignment</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Not_Daily</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Medication_Loop.Regime__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Once every two days</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Start_Date_Today</targetReference>
            </connector>
            <label>Not Daily</label>
        </rules>
        <rules>
            <name>Daily</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>Medication_Loop.Regime__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Once a Day</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Medication_Loop.Regime__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Twice a Day</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Medication_Loop.Regime__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Once a Cycle</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Medication_Loop.Regime__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Twice a Day</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Medication_Loop.Regime__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Three times a Day</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Medication_Assignment</targetReference>
            </connector>
            <label>Daily</label>
        </rules>
    </decisions>
    <decisions>
        <name>Start_Date_Today</name>
        <label>Start Date Today</label>
        <locationX>50</locationX>
        <locationY>953</locationY>
        <defaultConnector>
            <targetReference>Even_Day</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Is_Start_Date_Today</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Medication_Loop.Medication_Start_Date__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>CollectionDateOnly</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Medication_Assignment</targetReference>
            </connector>
            <label>Is Start Date Today</label>
        </rules>
    </decisions>
    <dynamicChoiceSets>
        <name>CycleOutcome</name>
        <dataType>Picklist</dataType>
        <displayField xsi:nil="true"/>
        <object xsi:nil="true"/>
        <picklistField>Cycle_Outcome__c</picklistField>
        <picklistObject>Case</picklistObject>
    </dynamicChoiceSets>
    <dynamicChoiceSets>
        <name>PregnancyOutcome</name>
        <dataType>Picklist</dataType>
        <displayField xsi:nil="true"/>
        <object xsi:nil="true"/>
        <picklistField>Pregnancy_Outcome__c</picklistField>
        <picklistObject>Case</picklistObject>
    </dynamicChoiceSets>
    <dynamicChoiceSets>
        <name>Result_Type_Picklist</name>
        <dataType>Picklist</dataType>
        <displayField xsi:nil="true"/>
        <object xsi:nil="true"/>
        <picklistField>Result_Type__c</picklistField>
        <picklistObject>Result__c</picklistObject>
    </dynamicChoiceSets>
    <dynamicChoiceSets>
        <name>WanttoBooknewappointment</name>
        <dataType>Picklist</dataType>
        <displayField xsi:nil="true"/>
        <object xsi:nil="true"/>
        <picklistField>Book_Appointment_Choice__c</picklistField>
        <picklistObject>Task</picklistObject>
    </dynamicChoiceSets>
    <formulas>
        <name>DateTransformation</name>
        <dataType>Date</dataType>
        <expression>DATEVALUE({!ResultVAR.Collected__c})</expression>
    </formulas>
    <formulas>
        <name>DaysBetweenDates</name>
        <dataType>Number</dataType>
        <expression>{!Medication_Loop.Medication_Start_Date__c}-{!Medication_Loop.Medication_End_Date__c}</expression>
        <scale>0</scale>
    </formulas>
    <formulas>
        <name>MedicationandDosage</name>
        <dataType>String</dataType>
        <expression>{!Medication1}&amp;&quot;-&quot;&amp;TEXT({!Dosage1})</expression>
    </formulas>
    <formulas>
        <name>ODDEVENFormula</name>
        <dataType>String</dataType>
        <expression>IF(MOD({!DaysBetweenDates}, 2) = 0, &apos;EVEN&apos; , &apos;ODD&apos;)</expression>
    </formulas>
    <interviewLabel>Subflow New Blood Test Result {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Subflow New Blood Test Result</label>
    <loops>
        <name>Medication_Loop</name>
        <label>Medication Loop</label>
        <locationX>373</locationX>
        <locationY>1174</locationY>
        <collectionReference>Get_Medications</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Regime_Not_Daily</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Update_Blood_Test_Result</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <recordLookups>
        <name>Get_Medications</name>
        <label>Get Medications</label>
        <locationX>845</locationX>
        <locationY>863</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Medication_Loop</targetReference>
        </connector>
        <filterLogic>1 AND 2 AND (3 OR 4)</filterLogic>
        <filters>
            <field>Related_Cycle__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <filters>
            <field>Medication_Start_Date__c</field>
            <operator>LessThanOrEqualTo</operator>
            <value>
                <elementReference>Get_Result.Date_Collected_Only__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Medication_End_Date__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Medication_End_Date__c</field>
            <operator>GreaterThanOrEqualTo</operator>
            <value>
                <elementReference>Get_Result.Date_Collected_Only__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Cycle_Medication__c</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>Dosage__c</queriedFields>
        <queriedFields>Medication__c</queriedFields>
        <queriedFields>Regime__c</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Result</name>
        <label>Get Result</label>
        <locationX>845</locationX>
        <locationY>354</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Blood_Test_Screen</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>ResultID</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Result__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_Blood_Test_Result</name>
        <label>Update Blood Test Result</label>
        <locationX>729</locationX>
        <locationY>1371</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>ResultVAR.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Medications__c</field>
            <value>
                <elementReference>AllMedicationsandDosages</elementReference>
            </value>
        </inputAssignments>
        <object>Result__c</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Result</name>
        <label>Update Result</label>
        <locationX>845</locationX>
        <locationY>666</locationY>
        <connector>
            <targetReference>Get_Medications</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>ResultID</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>E2__c</field>
            <value>
                <elementReference>E2</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>LH__c</field>
            <value>
                <elementReference>LH</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>P4__c</field>
            <value>
                <elementReference>P4</elementReference>
            </value>
        </inputAssignments>
        <object>Result__c</object>
    </recordUpdates>
    <screens>
        <name>Blood_Test_Screen</name>
        <label>Blood Test Screen</label>
        <locationX>850</locationX>
        <locationY>514</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>Update_Result</targetReference>
        </connector>
        <fields>
            <name>E2</name>
            <dataType>Number</dataType>
            <fieldText>E2</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>false</isRequired>
            <scale>0</scale>
        </fields>
        <fields>
            <name>LH</name>
            <dataType>Number</dataType>
            <fieldText>LH</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>false</isRequired>
            <scale>0</scale>
        </fields>
        <fields>
            <name>P4</name>
            <dataType>Number</dataType>
            <fieldText>P4</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>false</isRequired>
            <scale>0</scale>
        </fields>
        <fields>
            <name>Collection_Time_Blood_Test</name>
            <dataType>DateTime</dataType>
            <defaultValue>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </defaultValue>
            <fieldText>Collection Time - Blood Test</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>false</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <start>
        <locationX>719</locationX>
        <locationY>195</locationY>
        <connector>
            <targetReference>Get_Result</targetReference>
        </connector>
    </start>
    <status>Draft</status>
    <textTemplates>
        <name>LoopRecord</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>{!Medication_Loop.Medication__r.Name} - {!Medication_Loop.Dosage__c},</text>
    </textTemplates>
    <variables>
        <name>AllMedicationsandDosages</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>AllResultsonDay</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Result__c</objectType>
    </variables>
    <variables>
        <name>CollectionDateOnly</name>
        <dataType>Date</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>CountPregnancyResults</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>CountRecordsonDay</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>DateandTimeCollectionVariable</name>
        <dataType>DateTime</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>DateOnly</name>
        <dataType>Date</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>Dosage1</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>Medication1</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>recordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>ResultID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>ResultVAR</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Result__c</objectType>
    </variables>
    <variables>
        <name>Selected_Result_Type</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>YesNoBloodBooking</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
