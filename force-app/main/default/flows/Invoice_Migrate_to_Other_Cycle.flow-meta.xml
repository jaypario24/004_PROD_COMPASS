<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>54.0</apiVersion>
    <assignments>
        <name>Add_to_Collection</name>
        <label>Add to Collection</label>
        <locationX>1720</locationX>
        <locationY>1392</locationY>
        <assignmentItems>
            <assignToReference>DocumentLinkCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>NewDocumentLink</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Documents</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Global_Value</name>
        <label>Assign Global Value</label>
        <locationX>1371</locationX>
        <locationY>1196</locationY>
        <assignmentItems>
            <assignToReference>NewGlobalInvoice.Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Newly_Created_Invoice.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Document_Links</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_New_Document_Link</name>
        <label>Assign New Document Link</label>
        <locationX>1591</locationX>
        <locationY>1392</locationY>
        <assignmentItems>
            <assignToReference>NewDocumentLink.ContentDocumentId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Documents.ContentDocumentId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>NewDocumentLink.LinkedEntityId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>NewGlobalInvoice.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_to_Collection</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Create_New_Invoice_or_Apply_to_Exisiting</name>
        <label>Create New Invoice or Apply to Exisiting</label>
        <locationX>1078</locationX>
        <locationY>950</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Create_New</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>YesNo</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>No</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Create_New_Invoice</targetReference>
            </connector>
            <label>Create New</label>
        </rules>
        <rules>
            <name>Use_Exisiting</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>NewGlobalInvoice</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Document_Links</targetReference>
            </connector>
            <label>Use Exisiting</label>
        </rules>
        <rules>
            <name>Error</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>NewGlobalInvoice</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Error_Screen_Invoice_Select</targetReference>
            </connector>
            <label>Error</label>
        </rules>
    </decisions>
    <decisions>
        <name>Cycle_Same</name>
        <label>Cycle Same?</label>
        <locationX>465</locationX>
        <locationY>1264</locationY>
        <defaultConnector>
            <targetReference>Update_Invoice</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>No</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Selected_Cycle.RecordType.Id</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>Get_Invoice.Related_Cycle__r.RecordType.Id</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Existing_Invoices</targetReference>
            </connector>
            <label>No</label>
        </rules>
    </decisions>
    <decisions>
        <name>Cycles_Found</name>
        <label>Cycles Found</label>
        <locationX>472</locationX>
        <locationY>772</locationY>
        <defaultConnector>
            <targetReference>Select_Cycle_Screen</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>No_Cycles_found</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Cycles</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>No_Cycles_Found_Screen</targetReference>
            </connector>
            <label>No Cycles found</label>
        </rules>
        <rules>
            <name>Invoice_in_Credit</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Invoice.Amount_Outstanding__c</leftValueReference>
                <operator>LessThan</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Credit_Note_Application</targetReference>
            </connector>
            <label>Invoice in Credit</label>
        </rules>
    </decisions>
    <decisions>
        <name>Invoice_Already_Exists</name>
        <label>Invoice Already Exists</label>
        <locationX>791</locationX>
        <locationY>1195</locationY>
        <defaultConnector>
            <targetReference>Message_Screen</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Invoice_Exists</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Existing_Invoices</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Message_Screen_0</targetReference>
            </connector>
            <label>Invoice Exists</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_Payment_Amount_Greater_than_Credit</name>
        <label>Is Payment Amount Greater than Credit?</label>
        <locationX>1193</locationX>
        <locationY>768</locationY>
        <defaultConnector>
            <targetReference>Loop_Payments</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Loop_Payments.Payment_Amount__c</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <elementReference>CreditAmount</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Create_Credit_Note</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <environments>Default</environments>
    <formulas>
        <name>CreditAmount</name>
        <dataType>Currency</dataType>
        <expression>-{!Get_Invoice.Amount_Outstanding__c}</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>CreditNoteName</name>
        <dataType>String</dataType>
        <expression>&quot;Credit Note - &quot;&amp;{!Get_Invoice.Patients_Donors__r.Account.Name}&amp;&quot; - &quot;&amp;TEXT({!$Flow.CurrentDate})</expression>
    </formulas>
    <formulas>
        <name>NewPaymentAmount</name>
        <dataType>Currency</dataType>
        <expression>{!Loop_Payments.Payment_Amount__c}-{!CreditAmount}</expression>
        <scale>2</scale>
    </formulas>
    <interviewLabel>Invoice Migrate to Other Cycle {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Invoice Migrate to Other Cycle</label>
    <loops>
        <name>Loop_Documents</name>
        <label>Loop Documents</label>
        <locationX>1598</locationX>
        <locationY>1197</locationY>
        <collectionReference>Get_Document_Links</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_New_Document_Link</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Update_New_Document_Links</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_Payments</name>
        <label>Loop Payments</label>
        <locationX>1039</locationX>
        <locationY>770</locationY>
        <collectionReference>Get_All_Payments</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Is_Payment_Amount_Greater_than_Credit</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Error_Screen</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <recordCreates>
        <name>Create_Credit_Note</name>
        <label>Create Credit Note</label>
        <locationX>1396</locationX>
        <locationY>763</locationY>
        <connector>
            <targetReference>Update_Payment</targetReference>
        </connector>
        <inputAssignments>
            <field>Credit_Note__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Invoice__c</field>
            <value>
                <elementReference>Get_Invoice.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Link_for_Credit_Notes__c</field>
            <value>
                <elementReference>Get_Invoice.Patients_Donors__r.Account.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Name</field>
            <value>
                <elementReference>CreditNoteName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Payment_Amount__c</field>
            <value>
                <elementReference>CreditAmount</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Payment_Date__c</field>
            <value>
                <elementReference>Loop_Payments.Payment_Date__c</elementReference>
            </value>
        </inputAssignments>
        <object>Payments__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordDeletes>
        <name>Delete_Document_Links</name>
        <label>Delete Document Links</label>
        <locationX>2241</locationX>
        <locationY>1191</locationY>
        <inputReference>Get_Document_Links</inputReference>
    </recordDeletes>
    <recordDeletes>
        <name>Delete_Invoice</name>
        <label>Delete Invoice</label>
        <locationX>2089</locationX>
        <locationY>1191</locationY>
        <connector>
            <targetReference>Delete_Document_Links</targetReference>
        </connector>
        <inputReference>Get_Invoice</inputReference>
    </recordDeletes>
    <recordLookups>
        <name>Get_All_Payments</name>
        <label>Get All Payments</label>
        <locationX>880</locationX>
        <locationY>772</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_Payments</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Invoice__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_Invoice.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Payments__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Cycles</name>
        <label>Get Cycles</label>
        <locationX>480</locationX>
        <locationY>568</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Cycles_Found</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>NotEqualTo</operator>
            <value>
                <elementReference>Get_Invoice.Related_Cycle__r.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Closed Cycle - Completed</stringValue>
            </value>
        </filters>
        <filters>
            <field>AccountId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_Invoice.Related_Cycle__r.Contact.Account.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Case</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Document_Links</name>
        <label>Get Document Links</label>
        <locationX>1491</locationX>
        <locationY>1196</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_Documents</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>LinkedEntityId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>ContentDocumentLink</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Existing_Invoices</name>
        <label>Get Existing Invoices</label>
        <locationX>623</locationX>
        <locationY>1194</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Invoice_Already_Exists</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Related_Cycle__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>SelectedCycle.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Invoices__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Invoice</name>
        <label>Get Invoice</label>
        <locationX>482</locationX>
        <locationY>376</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Cycles</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Invoices__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Newly_Created_Invoice</name>
        <label>Get Newly Created Invoice</label>
        <locationX>1255</locationX>
        <locationY>1196</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Assign_Global_Value</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Related_Cycle__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>SelectedCycle.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Invoices__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Selected_Cycle</name>
        <label>Get Selected Cycle</label>
        <locationX>474</locationX>
        <locationY>1134</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Cycle_Same</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>SelectedCycle.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Case</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_Invoice</name>
        <label>Update Invoice</label>
        <locationX>478</locationX>
        <locationY>1396</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Related_Cycle__c</field>
            <value>
                <elementReference>SelectedCycle.Id</elementReference>
            </value>
        </inputAssignments>
        <object>Invoices__c</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_New_Document_Links</name>
        <label>Update New Document Links</label>
        <locationX>1784</locationX>
        <locationY>1192</locationY>
        <connector>
            <targetReference>Update_Payment_Details</targetReference>
        </connector>
        <inputReference>DocumentLinkCollection</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Payment</name>
        <label>Update Payment</label>
        <locationX>1578</locationX>
        <locationY>763</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Loop_Payments.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Payment_Amount__c</field>
            <value>
                <elementReference>NewPaymentAmount</elementReference>
            </value>
        </inputAssignments>
        <object>Payments__c</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Payment_Details</name>
        <label>Update Payment Details</label>
        <locationX>1934</locationX>
        <locationY>1191</locationY>
        <connector>
            <targetReference>Delete_Invoice</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Invoice__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Invoice__c</field>
            <value>
                <elementReference>NewGlobalInvoice.Id</elementReference>
            </value>
        </inputAssignments>
        <object>Payments__c</object>
    </recordUpdates>
    <screens>
        <name>Credit_Note_Application</name>
        <label>Credit Note Application</label>
        <locationX>701</locationX>
        <locationY>771</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Get_All_Payments</targetReference>
        </connector>
        <fields>
            <name>CreditNoteText</name>
            <fieldText>&lt;p&gt;This invoice is in credit. By proceeding you will be creating a credit note for the next invoice raise against this patient. &lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Error_Screen</name>
        <label>Error Screen</label>
        <locationX>1109</locationX>
        <locationY>645</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <fields>
            <name>EoorText</name>
            <fieldText>&lt;p&gt;There has been an issue processing this credit note. Please contact your system administrator for resolution. &lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Error_Screen_Invoice_Select</name>
        <label>Error Screen Invoice Select</label>
        <locationX>926</locationX>
        <locationY>875</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Message_Screen_0</targetReference>
        </connector>
        <fields>
            <name>NoInvoice</name>
            <fieldText>&lt;p&gt;You did not select an invoice or indicate that you wish to proceed. Press next to try again. &lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Message_Screen</name>
        <label>Message Screen</label>
        <locationX>972</locationX>
        <locationY>1194</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Create_New_Invoice</targetReference>
        </connector>
        <fields>
            <name>NoSameCycleTExt</name>
            <fieldText>&lt;p&gt;You are moving an invoice initially created for a different cycle type and as such you will need to create a new invoice before applying  this as a credit. &lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Message_Screen_0</name>
        <label>Message Screen</label>
        <locationX>801</locationX>
        <locationY>948</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Create_New_Invoice_or_Apply_to_Exisiting</targetReference>
        </connector>
        <fields>
            <name>NoSameCycleTExt_0</name>
            <fieldText>&lt;p&gt;You are moving an invoice initially created for a different cycle type. An Invoice already exists on this new cycle, would you like to apply the existing payment to this invoice? If you choose to allocate it against an existing invoice you must select it from the table below. &lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>InvoiceDIsplay</name>
            <dataTypeMappings>
                <typeName>T</typeName>
                <typeValue>Invoices__c</typeValue>
            </dataTypeMappings>
            <extensionName>c:datatable</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>objectName</name>
                <value>
                    <stringValue>Invoices__c</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>tableData</name>
                <value>
                    <elementReference>Get_Existing_Invoices</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>columnFields</name>
                <value>
                    <stringValue>Invoice_Number__c,Related_Cycle__c,Invoice_Date__c,Invoice_Total__c,Amounts_Paid__c,Amount_Outstanding__c</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>cb_matchCaseOnFilters</name>
                <value>
                    <stringValue>CB_FALSE</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>columnWidths</name>
                <value>
                    <stringValue>Invoice_Number__c:159, Related_Cycle__c:159, Invoice_Date__c:159, Invoice_Total__c:159, Amounts_Paid__c:159, Amount_Outstanding__c:159</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>singleRowSelection</name>
                <value>
                    <booleanValue>true</booleanValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>cb_singleRowSelection</name>
                <value>
                    <stringValue>CB_TRUE</stringValue>
                </value>
            </inputParameters>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
            <outputParameters>
                <assignToReference>NewGlobalInvoice</assignToReference>
                <name>outputSelectedRow</name>
            </outputParameters>
        </fields>
        <fields>
            <name>ApplytoExisting</name>
            <extensionName>c:YesNoPicklist</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>value</name>
                <value>
                    <elementReference>YesNo</elementReference>
                </value>
            </inputParameters>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
            <outputParameters>
                <assignToReference>YesNo</assignToReference>
                <name>value</name>
            </outputParameters>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>No_Cycles_Found_Screen</name>
        <label>No Cycles Found</label>
        <locationX>142</locationX>
        <locationY>876</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>NoCycleText</name>
            <fieldText>&lt;p&gt;&lt;b&gt;This patient doesn&apos;t have any cycles to roll this invoice over too. &lt;/b&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Select_Cycle_Screen</name>
        <label>Select Cycle Screen</label>
        <locationX>477</locationX>
        <locationY>1013</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>Get_Selected_Cycle</targetReference>
        </connector>
        <fields>
            <name>Cycle_Selection</name>
            <dataTypeMappings>
                <typeName>T</typeName>
                <typeValue>Case</typeValue>
            </dataTypeMappings>
            <extensionName>c:datatable</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>objectName</name>
                <value>
                    <stringValue>Case</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>tableData</name>
                <value>
                    <elementReference>Get_Cycles</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>columnFields</name>
                <value>
                    <stringValue>Cycle_Name__c,RecordTypeId,Status</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>cb_matchCaseOnFilters</name>
                <value>
                    <stringValue>CB_FALSE</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>columnWidths</name>
                <value>
                    <stringValue>Cycle_Name__c:314, RecordTypeId:314, Status:314</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>singleRowSelection</name>
                <value>
                    <booleanValue>true</booleanValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>cb_singleRowSelection</name>
                <value>
                    <stringValue>CB_TRUE</stringValue>
                </value>
            </inputParameters>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
            <outputParameters>
                <assignToReference>SelectedCycle</assignToReference>
                <name>outputSelectedRow</name>
            </outputParameters>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <start>
        <locationX>354</locationX>
        <locationY>45</locationY>
        <connector>
            <targetReference>Get_Invoice</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <subflows>
        <name>Create_New_Invoice</name>
        <label>Create New Invoice</label>
        <locationX>1085</locationX>
        <locationY>1196</locationY>
        <connector>
            <targetReference>Get_Newly_Created_Invoice</targetReference>
        </connector>
        <flowName>Invoice_Creation</flowName>
        <inputAssignments>
            <name>recordId</name>
            <value>
                <elementReference>SelectedCycle.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>SecondaryFlow</name>
            <value>
                <elementReference>SeondaryFlow</elementReference>
            </value>
        </inputAssignments>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </subflows>
    <variables>
        <name>DocumentLinkCollection</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ContentDocumentLink</objectType>
    </variables>
    <variables>
        <name>NewDocumentLink</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ContentDocumentLink</objectType>
    </variables>
    <variables>
        <name>NewGlobalInvoice</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Invoices__c</objectType>
    </variables>
    <variables>
        <name>recordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>SelectedCycle</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Case</objectType>
    </variables>
    <variables>
        <name>SeondaryFlow</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <value>
            <stringValue>Yes</stringValue>
        </value>
    </variables>
    <variables>
        <name>YesNo</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
